{% extends 'base.html' %}
{% load static %}

{% block title %}Teacher Dashboard - Pro{% endblock %}

{% block content %}
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    :root {
        --color1: #141619;
        --color2: #2C2E3A;
        --color3: #050A44;
        --color4: #0A21C0;
        --color5: #B3B4BD;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, var(--color1) 0%, var(--color3) 100%);
        min-height: 100vh;
        padding: 20px;
        color: var(--color1);
    }

    .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
    }

    /* Header */
    .dashboard-header {
        background: linear-gradient(135deg, var(--color2) 0%, var(--color1) 100%);
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 10px 40px rgba(10, 33, 192, 0.2);
        backdrop-filter: blur(10px);
        border: 1px solid var(--color4);
    }

    .header-content {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .header-avatar {
        width: 80px;
        height: 80px;
        border-radius: 16px;
        background: linear-gradient(135deg, var(--color4) 0%, var(--color3) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        color: white;
        box-shadow: 0 8px 20px rgba(10, 33, 192, 0.4);
        border: 2px solid var(--color4);
        animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }

    .header-info h1 {
        font-size: 28px;
        color: #ffffff;
        margin-bottom: 5px;
        font-weight: 700;
    }

    .header-subtitle {
        color: var(--color5);
        font-size: 14px;
    }

    .header-actions {
        display: flex;
        gap: 15px;
        align-items: center;
    }

    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--color4) 0%, var(--color3) 100%);
        color: white;
        box-shadow: 0 8px 20px rgba(10, 33, 192, 0.4);
        border: 1px solid var(--color4);
    }

    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 30px rgba(10, 33, 192, 0.5);
    }

    .btn-secondary {
        background: var(--color2);
        color: var(--color4);
        border: 2px solid var(--color4);
    }

    .btn-secondary:hover {
        background: var(--color4);
        color: white;
        transform: translateY(-3px);
    }

    /* Navigation Tabs */
    .nav-tabs {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
        border-bottom: 2px solid var(--color3);
        padding-bottom: 0;
    }

    .nav-tab {
        padding: 12px 20px;
        background: none;
        border: none;
        color: var(--color5);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border-bottom: 3px solid transparent;
        font-size: 16px;
    }

    .nav-tab.active {
        color: var(--color4);
        border-bottom-color: var(--color4);
    }

    .nav-tab:hover {
        color: var(--color4);
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: linear-gradient(135deg, var(--color2) 0%, var(--color1) 100%);
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(10, 33, 192, 0.15);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        border: 1px solid var(--color3);
        cursor: pointer;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--color4), var(--color3));
    }

    .stat-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 50px rgba(10, 33, 192, 0.25);
        border-color: var(--color4);
    }

    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        margin-bottom: 15px;
    }

    .stat-icon.primary {
        background: rgba(10, 33, 192, 0.2);
        color: var(--color4);
    }

    .stat-label {
        color: var(--color5);
        font-size: 13px;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .stat-value {
        font-size: 32px;
        font-weight: 700;
        color: var(--color4);
    }

    /* Courses Section */
    .courses-section {
        background: linear-gradient(135deg, var(--color2) 0%, var(--color1) 100%);
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(10, 33, 192, 0.15);
        margin-bottom: 30px;
        border: 1px solid var(--color3);
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        flex-wrap: wrap;
        gap: 15px;
    }

    .section-title {
        font-size: 22px;
        font-weight: 700;
        color: #ffffff;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .search-filter-group {
        display: flex;
        gap: 15px;
        align-items: center;
    }

    .search-box {
        position: relative;
        width: 280px;
    }

    .search-box input {
        width: 100%;
        padding: 12px 16px 12px 40px;
        border: 2px solid var(--color3);
        border-radius: 10px;
        font-size: 14px;
        transition: all 0.3s ease;
        background: var(--color1);
        color: var(--color5);
    }

    .search-box input::placeholder {
        color: var(--color5);
    }

    .search-box input:focus {
        outline: none;
        border-color: var(--color4);
        box-shadow: 0 0 0 3px rgba(10, 33, 192, 0.2);
        background: var(--color2);
        color: #ffffff;
    }

    .search-box::before {
        content: 'üîç';
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 16px;
    }

    .filter-select {
        padding: 12px 16px;
        border: 2px solid var(--color3);
        border-radius: 10px;
        font-size: 14px;
        background: var(--color1);
        color: var(--color5);
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 180px;
    }

    .filter-select:focus {
        outline: none;
        border-color: var(--color4);
        box-shadow: 0 0 0 3px rgba(10, 33, 192, 0.2);
        background: var(--color2);
    }

    .courses-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
    }

    .course-card {
        background: linear-gradient(135deg, var(--color2) 0%, var(--color1) 100%);
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(10, 33, 192, 0.15);
        transition: all 0.3s ease;
        border: 1px solid var(--color3);
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .course-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at top right, rgba(10, 33, 192, 0.1), transparent);
        pointer-events: none;
    }

    .course-card:hover {
        transform: translateY(-12px);
        box-shadow: 0 20px 50px rgba(10, 33, 192, 0.3);
        border-color: var(--color4);
    }

    .course-header {
        background: linear-gradient(135deg, var(--color4) 0%, var(--color3) 100%);
        padding: 20px;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .course-code {
        font-size: 12px;
        opacity: 0.9;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .course-name {
        font-size: 20px;
        font-weight: 700;
        margin-bottom: 5px;
    }

    .course-body {
        padding: 20px;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 1;
    }

    .course-badge {
        display: inline-block;
        background: rgba(10, 33, 192, 0.2);
        color: var(--color4);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 11px;
        margin-bottom: 15px;
        font-weight: 600;
    }

    .course-meta {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 10px;
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
        color: var(--color5);
    }

    .meta-item strong {
        color: var(--color4);
    }

    .course-progress {
        margin-bottom: 20px;
    }

    .progress-bar {
        width: 100%;
        height: 6px;
        background: var(--color3);
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 6px;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--color4), var(--color3));
        border-radius: 3px;
        transition: width 0.3s ease;
    }

    .progress-text {
        font-size: 12px;
        color: var(--color5);
        display: flex;
        justify-content: space-between;
    }

    .course-actions {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: auto;
    }

    .action-btn {
        padding: 10px 14px;
        font-size: 12px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        text-align: center;
    }

    .action-btn-primary {
        background: linear-gradient(135deg, var(--color4) 0%, var(--color3) 100%);
        color: white;
        border: 1px solid var(--color4);
    }

    .action-btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(10, 33, 192, 0.3);
    }

    .action-btn-secondary {
        background: var(--color3);
        color: var(--color4);
        border: 1px solid var(--color4);
    }

    .action-btn-secondary:hover {
        background: var(--color4);
        color: white;
        transform: translateY(-2px);
    }

    /* Quick Actions Widget */
    .quick-actions {
        background: linear-gradient(135deg, var(--color2) 0%, var(--color1) 100%);
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(10, 33, 192, 0.15);
        border: 1px solid var(--color3);
        margin-bottom: 30px;
    }

    .actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 15px;
    }

    .action-card {
        background: var(--color1);
        border: 2px solid var(--color3);
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .action-card:hover {
        border-color: var(--color4);
        background: var(--color2);
        transform: translateY(-5px);
    }

    .action-icon {
        font-size: 32px;
        margin-bottom: 10px;
    }

    .action-text {
        font-weight: 600;
        color: #ffffff;
        font-size: 14px;
    }

    /* Notifications Panel */
    .notifications-panel {
        background: linear-gradient(135deg, var(--color2) 0%, var(--color1) 100%);
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(10, 33, 192, 0.15);
        border: 1px solid var(--color3);
        margin-bottom: 30px;
    }

    .notification-item {
        display: flex;
        gap: 15px;
        padding: 15px;
        background: var(--color1);
        border-radius: 10px;
        margin-bottom: 12px;
        border-left: 4px solid var(--color4);
        transition: all 0.3s ease;
    }

    .notification-item:hover {
        background: var(--color2);
        transform: translateX(5px);
    }

    .notification-icon {
        font-size: 24px;
        flex-shrink: 0;
    }

    .notification-content {
        flex-grow: 1;
    }

    .notification-title {
        font-weight: 600;
        color: #ffffff;
        margin-bottom: 4px;
    }

    .notification-time {
        font-size: 12px;
        color: var(--color5);
    }

    /* Activity Feed */
    .activity-section {
        background: linear-gradient(135deg, var(--color2) 0%, var(--color1) 100%);
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(10, 33, 192, 0.15);
        border: 1px solid var(--color3);
    }

    .activity-item {
        display: flex;
        gap: 15px;
        padding: 15px 0;
        border-bottom: 1px solid var(--color3);
        align-items: flex-start;
    }

    .activity-item:last-child {
        border-bottom: none;
    }

    .activity-dot {
        width: 12px;
        height: 12px;
        background: linear-gradient(135deg, var(--color4), var(--color3));
        border-radius: 50%;
        margin-top: 6px;
        flex-shrink: 0;
        box-shadow: 0 0 8px rgba(10, 33, 192, 0.4);
    }

    .activity-content {
        flex-grow: 1;
    }

    .activity-title {
        font-weight: 600;
        color: #ffffff;
        margin-bottom: 4px;
    }

    .activity-time {
        font-size: 13px;
        color: var(--color5);
    }

    /* Calendar Widget */
    .calendar-widget {
        background: linear-gradient(135deg, var(--color2) 0%, var(--color1) 100%);
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(10, 33, 192, 0.15);
        border: 1px solid var(--color3);
        margin-bottom: 30px;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin-top: 15px;
    }

    .calendar-day {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        background: var(--color1);
        color: var(--color5);
        font-size: 12px;
        border: 1px solid var(--color3);
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .calendar-day:hover, .calendar-day.active {
        background: var(--color4);
        color: white;
        transform: scale(1.1);
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
    }

    .empty-icon {
        font-size: 64px;
        margin-bottom: 20px;
        opacity: 0.5;
    }

    .empty-text {
        font-size: 18px;
        color: var(--color5);
        margin-bottom: 25px;
    }

    @media (max-width: 768px) {
        .dashboard-header {
            flex-direction: column;
            text-align: center;
        }

        .courses-grid {
            grid-template-columns: 1fr;
        }

        .search-filter-group {
            flex-direction: column;
            width: 100%;
        }

        .course-actions {
            grid-template-columns: 1fr;
        }

        .search-box, .filter-select {
            width: 100%;
        }

        .header-actions {
            width: 100%;
            justify-content: center;
        }

        .btn {
            width: 100%;
            justify-content: center;
        }

        .actions-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .nav-tabs {
            overflow-x: auto;
        }
    }

    ::-webkit-scrollbar {
        width: 8px;
    }

    ::-webkit-scrollbar-track {
        background: var(--color1);
    }

    ::-webkit-scrollbar-thumb {
        background: var(--color4);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: var(--color3);
    }
</style>

<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
        <div class="header-content">
            <div class="header-avatar">üë®‚Äçüè´</div>
            <div class="header-info">
                <h1>Welcome Back! {{ user.get_full_name|default:user.username }}</h1>
                <p class="header-subtitle">You have 4 classes today. Everything is on track! üìö</p>
            </div>
        </div>
        <div class="header-actions">
            <button onclick="showOneStepGuideTeacher()" class="btn btn-secondary" title="One Step Guide">
                ‚ö° One Step
            </button>
            <button onclick="markAllNotificationsReadTeacher()" class="btn btn-secondary" title="Mark All as Read">
                ‚úì Read
            </button>
            <a href="{% url 'teacher_schedules' %}" class="btn btn-secondary">
                üìÖ Schedule
            </a>
            <a href="{% url 'download_teacher_report' %}" class="btn btn-secondary">
                üìä Performance Report
            </a>
            <a href="{% url 'add_course' %}" class="btn btn-primary">
                ‚ûï Add Course
            </a>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
        <button class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
        <button class="nav-tab" onclick="showTab('courses')">üìö Courses</button>
        <button class="nav-tab" onclick="showTab('notifications')">üîî Notifications</button>
        <button class="nav-tab" onclick="showTab('calendar')">üìÖ Calendar</button>
    </div>

    <!-- Dashboard Tab -->
    <div id="dashboard" class="tab-content active">
        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon primary">üìä</div>
                <div class="stat-label">Active Courses</div>
                <div class="stat-value">12</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon primary">üë•</div>
                <div class="stat-label">Total Students</div>
                <div class="stat-value">342</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon primary">üìù</div>
                <div class="stat-label">Pending Tasks</div>
                <div class="stat-value">8</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon primary">‚ö°</div>
                <div class="stat-label">Attendance Rate</div>
                <div class="stat-value">94%</div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h3 class="section-title" style="margin-bottom: 20px;">‚ö° Quick Actions</h3>
            <div class="actions-grid">
                <div class="action-card" data-action="start_class">
                    <div class="action-icon">üéì</div>
                    <div class="action-text">Start Class</div>
                </div>
                <div class="action-card" data-action="new_assignment">
                    <div class="action-icon">‚úçÔ∏è</div>
                    <div class="action-text">New Assignment</div>
                </div>
                <div class="action-card" data-action="generate_report">
                    <div class="action-icon">üìà</div>
                    <div class="action-text">Generate Report</div>
                </div>
                <div class="action-card" data-action="send_message">
                    <div class="action-icon">üí¨</div>
                    <div class="action-text">Send Message</div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="activity-section">
            <h2 class="section-title" style="margin-bottom: 20px;">üîî Recent Activity</h2>
            <div class="activity-item">
                <div class="activity-dot"></div>
                <div class="activity-content">
                    <div class="activity-title">New assignment submitted</div>
                    <div class="activity-time">3 students submitted their work in Web Design ‚Ä¢ 2 mins ago</div>
                </div>
            </div>
            <div class="activity-item">
                <div class="activity-dot"></div>
                <div class="activity-content">
                    <div class="activity-title">Attendance recorded</div>
                    <div class="activity-time">Marked attendance for Machine Learning - 28 present ‚Ä¢ 15 mins ago</div>
                </div>
            </div>
            <div class="activity-item">
                <div class="activity-dot"></div>
                <div class="activity-content">
                    <div class="activity-title">Course material updated</div>
                    <div class="activity-time">New lecture notes added to Data Structures ‚Ä¢ 1 hour ago</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Courses Tab -->
    <div id="courses" class="tab-content">
        <div class="courses-section">
            <div class="section-header">
                <h2 class="section-title">üìö My Courses</h2>
                <div class="search-filter-group">
                    <div class="search-box">
                        <input type="text" id="courseSearch" placeholder="Search courses...">
                    </div>
                    <select class="filter-select" id="semesterFilter">
                        <option value="">All Semesters</option>
                        <option value="1">Semester 1</option>
                        <option value="2">Semester 2</option>
                        <option value="3">Semester 3</option>
                        <option value="4">Semester 4</option>
                    </select>
                </div>
            </div>

            <div class="courses-grid" id="coursesContainer">
                {% if courses %}
                    {% for course in courses %}
                    <div class="course-card" data-course-id="{{ course.id }}" data-semester="{{ course.semester }}" data-name="{{ course.name|lower }}">
                        <div class="course-header">
                            <div class="course-code">{{ course.code }}</div>
                            <div class="course-name">{{ course.name }}</div>
                        </div>
                        <div class="course-body">
                            <div class="course-badge">ACTIVE</div>
                            <div class="course-meta">
                                <div class="meta-item">
                                    <span>‚≠ê</span>
                                    <strong>{{ course.credits }}</strong> Credits
                                </div>
                                <div class="meta-item">
                                    <span>üë•</span>
                                    <strong>{{ course.enrolled_students|default:0 }}</strong> Students
                                </div>
                            </div>
                            <div class="course-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 75%"></div>
                                </div>
                                <div class="progress-text">
                                    <span>Progress</span>
                                    <span>75%</span>
                                </div>
                            </div>
                            <div class="course-actions">
                                <a href="{% url 'course_detail' course.id %}" class="action-btn action-btn-primary">
                                    üìã Details
                                </a>
                                <a href="{% url 'course_assignments' course.id %}" class="action-btn action-btn-secondary">
                                    üìù Assignments
                                </a>
                                <a href="{% url 'take_attendance' course.id %}" class="action-btn action-btn-secondary">
                                    ‚úÖ Attendance
                                </a>
                                <a href="{% url 'manage_materials' course.id %}" class="action-btn action-btn-primary">
                                    üìÅ Materials
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div style="grid-column: 1 / -1;">
                        <div class="empty-state">
                            <div class="empty-icon">üìö</div>
                            <div class="empty-text">No Courses Yet</div>
                            <a href="{% url 'add_course' %}" class="btn btn-primary">
                                ‚ûï Add Your First Course
                            </a>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Notifications Tab -->
    <div id="notifications" class="tab-content">
        <div class="notifications-panel">
            <h2 class="section-title" style="margin-bottom: 20px;">üîî All Notifications</h2>
            <div class="notification-item">
                <div class="notification-icon">üì¢</div>
                <div class="notification-content">
                    <div class="notification-title">System Update Available</div>
                    <div class="notification-time">New features added to the dashboard ‚Ä¢ 30 mins ago</div>
                </div>
            </div>
            <div class="notification-item">
                <div class="notification-icon">üë•</div>
                <div class="notification-content">
                    <div class="notification-title">New Student Enrolled</div>
                    <div class="notification-time">5 students enrolled in Web Design course ‚Ä¢ 1 hour ago</div>
                </div>
            </div>
            <div class="notification-item">
                <div class="notification-icon">üìù</div>
                <div class="notification-content">
                    <div class="notification-title">Assignment Deadline Tomorrow</div>
                    <div class="notification-time">Remind students about Data Structures assignment ‚Ä¢ 2 hours ago</div>
                </div>
            </div>
            <div class="notification-item">
                <div class="notification-icon">‚úÖ</div>
                <div class="notification-content">
                    <div class="notification-title">All Grades Submitted</div>
                    <div class="notification-time">Final grades for Semester 1 courses submitted ‚Ä¢ 4 hours ago</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar Tab -->
    <div id="calendar" class="tab-content">
        <div class="calendar-widget">
            <h2 class="section-title" id="current-month">üìÖ Loading...</h2>
            <div class="calendar-grid" id="calendar-days"></div>

<script>
function updateCalendar() {
    const date = new Date();
    const month = date.toLocaleString('default', { month: 'long' });
    const year = date.getFullYear();

    // Update month/year display
    document.getElementById('current-month').textContent = `üìÖ ${month} ${year}`;

    const daysGrid = document.getElementById('calendar-days');
    daysGrid.innerHTML = '';

    // Get first day of month and total days
    const firstDay = new Date(date.getFullYear(), date.getMonth(), 1).getDay();
    const totalDays = new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();

    // Add empty cells for days before first of month
    for(let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day';
        daysGrid.appendChild(emptyDay);
    }

    // Add calendar days
    for(let i = 1; i <= totalDays; i++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        
        // Highlight current day
        if(i === date.getDate()) {
            dayElement.classList.add('active');
        }

        // Add date and event indicator if exists
        const dateStr = `${year}-${(date.getMonth()+1).toString().padStart(2,'0')}-${i.toString().padStart(2,'0')}`;
        const hasEvent = checkForEvents(dateStr);
        
        dayElement.innerHTML = `
            ${i}
            ${hasEvent ? '<span class="event-dot">‚Ä¢</span>' : ''}
        `;
        
        // Add click handler to show events
        dayElement.addEventListener('click', () => showEvents(dateStr));
        
        daysGrid.appendChild(dayElement);
    }
}

// Dummy events data - replace with real data from backend
const events = {
    '2024-01-01': [{title: 'New Year Holiday'}],
    '2024-01-15': [{title: 'Staff Meeting'}, {title: 'Course Review'}]
};

function checkForEvents(date) {
    return events[date] && events[date].length > 0;
}

function showEvents(date) {
    const dayEvents = events[date] || [];
    if(dayEvents.length === 0) {
        alert('No events scheduled for this day');
        return;
    }

    const eventList = dayEvents.map(e => e.title).join('\n- ');
    alert(`Events for ${date}:\n- ${eventList}`);
}

// Update calendar immediately and every minute
updateCalendar();
setInterval(updateCalendar, 60000);

// Add some extra styles for events
const style = document.createElement('style');
style.textContent = `
    .calendar-day {
        position: relative;
    }
    .event-dot {
        position: absolute;
        bottom: 5px;
        left: 50%;
        transform: translateX(-50%);
        color: var(--color4);
        font-size: 20px;
    }
`;
document.head.appendChild(style);
</script>

            <div class="quick-actions" style="margin-top: 30px;">
                <h3 class="section-title" style="margin-bottom: 20px;">üìã Scheduled Events</h3>
                <div class="activity-item">
                    <div class="activity-dot"></div>
                    <div class="activity-content">
                        <div class="activity-title">Machine Learning Class</div>
                        <div class="activity-time">Today at 10:30 AM ‚Ä¢ Room 201</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-dot"></div>
                    <div class="activity-content">
                        <div class="activity-title">Staff Meeting</div>
                        <div class="activity-time">Today at 3:00 PM ‚Ä¢ Conference Hall</div>
                    </div>
                </div>
                <div class="activity-item">
                    <div class="activity-dot"></div>
                    <div class="activity-content">
                        <div class="activity-title">Grade Submission Deadline</div>
                        <div class="activity-time">Tomorrow at 11:59 PM</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function showTab(tabName) {
        // Hide all tabs
        const tabs = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => tab.classList.remove('active'));
        
        // Remove active class from all nav tabs
        const navTabs = document.querySelectorAll('.nav-tab');
        navTabs.forEach(tab => tab.classList.remove('active'));
        
        // Show selected tab
        document.getElementById(tabName).classList.add('active');
        
        // Add active class to clicked nav tab
        event.target.classList.add('active');
    }

    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('courseSearch');
        const semesterFilter = document.getElementById('semesterFilter');
        const courseCards = document.querySelectorAll('.course-card');

        function filterCourses() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedSemester = semesterFilter.value;

            courseCards.forEach(card => {
                const courseName = card.dataset.name;
                const courseSemester = card.dataset.semester;
                
                const matchesSearch = courseName.includes(searchTerm);
                const matchesSemester = !selectedSemester || courseSemester === selectedSemester;
                
                card.style.display = (matchesSearch && matchesSemester) ? '' : 'none';
            });
        }

        if (searchInput) {
            searchInput.addEventListener('input', filterCourses);
        }
        
        if (semesterFilter) {
            semesterFilter.addEventListener('change', filterCourses);
        }

        // Calendar day click functionality
        const calendarDays = document.querySelectorAll('.calendar-day');
        calendarDays.forEach(day => {
            day.addEventListener('click', function() {
                calendarDays.forEach(d => d.classList.remove('active'));
                this.classList.add('active');
            });
        });
    });
</script>

{% endblock %}

{% block extra_js %}
<script>
// Quick Actions wiring
function getCookie(name) {
    const v = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
    return v ? v.pop() : '';
}

document.addEventListener('DOMContentLoaded', function(){
    const actions = document.querySelectorAll('.action-card[data-action]');
    if (!actions) return;

    // Helper: pick a course id from the first course card in the page or prompt user
    function pickCourseId() {
        const first = document.querySelector('.course-card');
        if (first && first.dataset && first.dataset.courseId) return first.dataset.courseId;
        // try to derive from link
        const link = document.querySelector('.action-btn[href*="course/"]');
        if (link) {
            const m = link.getAttribute('href').match(/course\/(\d+)/);
            if (m) return m[1];
        }
        return null;
    }

    actions.forEach(card => {
        card.addEventListener('click', async function(){
            const action = this.dataset.action;
            if (action === 'start_class') {
                // Redirect to top course or show a simple modal (fallback)
                const cid = pickCourseId();
                if (cid) {
                    window.location.href = `/course/${cid}/`;
                } else {
                    alert('No course found to start class for.');
                }
            }

            if (action === 'new_assignment') {
                const title = prompt('Assignment title:');
                if (!title) return alert('Cancelled');
                const due = prompt('Due date (YYYY-MM-DD) ‚Äî leave blank for none:');
                const max = prompt('Max marks (default 100):', '100');
                const courseId = pickCourseId();
                if (!courseId) return alert('No course found to create assignment for.');

                const form = new FormData();
                form.append('title', title);
                if (due) form.append('due_date', due);
                form.append('max_marks', max || '100');
                form.append('course_id', courseId);

                const resp = await fetch('/teacher/assignment/create/', {
                    method: 'POST',
                    headers: { 'X-CSRFToken': getCookie('csrftoken') },
                    body: form
                });
                const data = await resp.json();
                if (data && data.success) {
                    alert('Assignment created successfully (id: ' + data.assignment_id + ')');
                    location.reload();
                } else {
                    alert('Error creating assignment: ' + (data && data.error ? data.error : resp.statusText));
                }
            }

            if (action === 'generate_report') {
                const courseId = pickCourseId();
                if (!courseId) return alert('No course found to generate report for.');
                // Open modal to choose PDF or Excel
                openReportModal(courseId);
            }

            if (action === 'send_message') {
                const message = prompt('Message to students:');
                if (!message) return alert('Cancelled');
                const courseId = pickCourseId();
                if (!courseId) return alert('No course found to send message to.');

                const form = new FormData();
                form.append('message', message);
                form.append('course_id', courseId);

                const resp = await fetch('/teacher/send-message/', {
                    method: 'POST',
                    headers: { 'X-CSRFToken': getCookie('csrftoken') },
                    body: form
                });
                const data = await resp.json();
                if (data && data.success) {
                    alert('Message sent to ' + data.sent + ' students');
                } else {
                    alert('Error sending message: ' + (data && data.error ? data.error : resp.statusText));
                }
            }
        });
    });
});
</script>
<!-- Report chooser modal -->
<div id="reportModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:2000;">
    <div style="background:white; padding:20px; border-radius:8px; width:420px; color:#111;">
        <h4 style="margin-top:0;">Generate Report</h4>

        <div style="margin-bottom:10px;">
            <label for="reportCourse">Select Course / Batch</label>
            <select id="reportCourse" class="filter-select" style="width:100%; margin-top:6px;"></select>
        </div>

        <div style="margin-bottom:10px;">
            <label for="reportStudent">Student (optional)</label>
            <select id="reportStudent" class="filter-select" style="width:100%; margin-top:6px;"><option value="">All students</option></select>
        </div>

        <div style="display:flex; gap:8px; margin-bottom:10px;">
            <div style="flex:1;">
                <label for="reportStart">Start (YYYY-MM-DD)</label>
                <input id="reportStart" class="filter-select" placeholder="2025-01-01" style="width:100%; margin-top:6px; padding:8px;" />
            </div>
            <div style="flex:1;">
                <label for="reportEnd">End (YYYY-MM-DD)</label>
                <input id="reportEnd" class="filter-select" placeholder="2025-12-31" style="width:100%; margin-top:6px; padding:8px;" />
            </div>
        </div>

        <div style="margin-bottom:12px;">
            <label>Report Type</label>
            <div style="display:flex; gap:8px; margin-top:6px;">
                <button id="reportTypeCourse" class="btn btn-primary" style="flex:1;">Course</button>
                <button id="reportTypeStudent" class="btn btn-secondary" style="flex:1;">Student</button>
                <button id="reportTypeAssign" class="btn btn-secondary" style="flex:1;">Assignment Averages</button>
            </div>
        </div>

        <div style="margin-bottom:12px;">
            <label>Format</label>
            <div style="display:flex; gap:8px; margin-top:6px;">
                <button id="formatCsv" class="btn btn-primary" style="flex:1;">CSV</button>
                <button id="formatPdf" class="btn btn-secondary" style="flex:1;">PDF</button>
                <button id="formatExcel" class="btn btn-secondary" style="flex:1;">Excel</button>
            </div>
        </div>

        <div style="margin-bottom:12px; display:flex; align-items:center; gap:8px;">
            <input type="checkbox" id="selectAllStudents" />
            <label for="selectAllStudents" style="margin:0;">Select all students (bulk)</label>
        </div>

        <div style="text-align:right; margin-top:12px; display:flex; gap:8px; justify-content:flex-end;">
            <button id="reportGenerate" class="btn btn-primary">Generate</button>
            <button id="reportCancel" class="btn" style="background:transparent;">Cancel</button>
        </div>
    </div>
</div>
<script>
function openReportModal(courseId){
    const modal = document.getElementById('reportModal');
    modal.style.display = 'flex';
    const cancel = document.getElementById('reportCancel');
    const generateBtn = document.getElementById('reportGenerate');
    const courseSelect = document.getElementById('reportCourse');
    const studentSelect = document.getElementById('reportStudent');
    const startInput = document.getElementById('reportStart');
    const endInput = document.getElementById('reportEnd');
    const typeCourse = document.getElementById('reportTypeCourse');
    const typeStudent = document.getElementById('reportTypeStudent');
    const typeAssign = document.getElementById('reportTypeAssign');
    const fmtCsv = document.getElementById('formatCsv');
    const fmtPdf = document.getElementById('formatPdf');
    const fmtExcel = document.getElementById('formatExcel');
    const selectAllCheckbox = document.getElementById('selectAllStudents');

    function cleanup(){
        modal.style.display = 'none';
        generateBtn.onclick = null;
        cancel.onclick = null;
    }

    // Pre-populate course select if courses are present in the DOM
    function populateCourses(selectedId){
        courseSelect.innerHTML = '';
        const courses = Array.from(document.querySelectorAll('.course-card'));
        // Add a placeholder option
        const placeholder = document.createElement('option');
        placeholder.value = '';
        placeholder.textContent = '-- Select course --';
        courseSelect.appendChild(placeholder);
        courses.forEach(c => {
            const opt = document.createElement('option');
            opt.value = c.dataset.courseId || c.getAttribute('data-course-id') || c.dataset.id || '';
            opt.textContent = c.querySelector('.course-name') ? c.querySelector('.course-name').textContent.trim() : (c.dataset.name || 'Course');
            courseSelect.appendChild(opt);
        });
        if (selectedId) courseSelect.value = selectedId;
    }

    async function loadStudentsForCourse(cid){
        studentSelect.innerHTML = '<option value="">All students</option>';
        if (!cid) return;
        try{
            const resp = await fetch(`/teacher/course/${cid}/students-json/`);
            if (!resp.ok) return;
            const data = await resp.json();
            (data.students || []).forEach(s => {
                const o = document.createElement('option');
                o.value = s.id;
                o.textContent = s.full_name || s.username || s.id;
                studentSelect.appendChild(o);
            });
        }catch(e){ console.warn('Could not load students', e); }
    }

    populateCourses(courseId);
    if (courseId) loadStudentsForCourse(courseId);

    courseSelect.onchange = function(){ loadStudentsForCourse(this.value); };

    generateBtn.onclick = function(){
        const cid = courseSelect.value || courseId;
        if (!cid) return alert('Please select a course');
        const sid = studentSelect.value;
        const start = startInput.value;
        const end = endInput.value;
        // Determine selected report type (which button is primary-styled)
        let reportType = 'course';
        if (typeStudent.classList.contains('btn-primary')) reportType = 'student';
        if (typeAssign.classList.contains('btn-primary')) reportType = 'assign';

        // Determine format
        let format = 'csv';
        if (fmtPdf.classList.contains('btn-primary')) format = 'pdf';
        if (fmtExcel.classList.contains('btn-primary')) format = 'excel';

        const selectAll = selectAllCheckbox && selectAllCheckbox.checked;

        // Build query params
        const params = new URLSearchParams();
        if (start) params.append('start', start);
        if (end) params.append('end', end);

        if (reportType === 'course'){
            // Course-level
            cleanup();
            if (format === 'pdf') {
                window.location.href = `/teacher/course/${cid}/report/pdf/?` + params.toString();
            } else {
                // csv or excel -> use existing CSV endpoint; add format flag for client-side handling
                if (format === 'excel') params.append('format', 'excel');
                window.location.href = `/teacher/course/${cid}/report/?` + params.toString();
            }
            return;
        }

        if (reportType === 'student'){
            if (selectAll) {
                // Bulk: fallback to course-level report since per-student bulk PDF/Excel isn't implemented yet
                cleanup();
                if (format === 'pdf') {
                    window.location.href = `/teacher/course/${cid}/report/pdf/?` + params.toString();
                } else {
                    if (format === 'excel') params.append('format', 'excel');
                    window.location.href = `/teacher/course/${cid}/report/?` + params.toString();
                }
                return;
            }

            if (!sid) return alert('Select a student for Student report');
            cleanup();
            // Student report is CSV via teacher_student_report endpoint
            window.location.href = `/teacher/course/${cid}/student/${sid}/report/?` + params.toString();
            return;
        }

        if (reportType === 'assign'){
            cleanup();
            window.location.href = `/teacher/course/${cid}/assignment-averages/?` + params.toString();
            return;
        }
    };

    cancel.onclick = cleanup;

    // Type toggle buttons
    [typeCourse, typeStudent, typeAssign].forEach(btn => {
        btn.onclick = function(){
            // reset
            [typeCourse, typeStudent, typeAssign].forEach(b => b.classList.remove('btn-primary'));
            [typeCourse, typeStudent, typeAssign].forEach(b => b.classList.add('btn-secondary'));
            this.classList.remove('btn-secondary');
            this.classList.add('btn-primary');
        };
    });

    // Format toggle buttons
    [fmtCsv, fmtPdf, fmtExcel].forEach(btn => {
        btn.onclick = function(){
            [fmtCsv, fmtPdf, fmtExcel].forEach(b => b.classList.remove('btn-primary'));
            [fmtCsv, fmtPdf, fmtExcel].forEach(b => b.classList.add('btn-secondary'));
            this.classList.remove('btn-secondary');
            this.classList.add('btn-primary');
        };
    });
}
    async function pollTeacherUpdates() {
        try {
            const resp = await fetch('{% url "teacher_dashboard_updates" %}');
            if (!resp.ok) return;
            const data = await resp.json();
            // data.recent_activities expected
            if (data && data.recent_activities && data.recent_activities.length) {
                const container = document.querySelector('.activity-section');
                if (!container) return;
                // Prepend new activities
                data.recent_activities.slice(0,5).forEach(act => {
                    // skip if already present by title/time
                    const exists = Array.from(container.querySelectorAll('.activity-title')).some(el => el.textContent === act.title);
                    if (exists) return;
                    const item = document.createElement('div');
                    item.className = 'activity-item';
                    item.innerHTML = `
                        <div class="activity-dot"></div>
                        <div class="activity-content">
                            <div class="activity-title">${act.title}</div>
                            <div class="activity-time">${new Date(act.time).toLocaleString()}</div>
                        </div>
                    `;
                    // prepend
                    container.insertAdjacentElement('afterbegin', item);
                    showToast(act.title);
                });
            }
        } catch (e) {
            // ignore polling errors silently
            console.log('Update poll error', e);
        }
    }

    function showToast(message) {
        let toast = document.getElementById('live-toast');
        if (!toast) {
            toast = document.createElement('div');
            toast.id = 'live-toast';
            toast.style.position = 'fixed';
            toast.style.right = '20px';
            toast.style.bottom = '20px';
            toast.style.background = 'rgba(0,0,0,0.8)';
            toast.style.color = '#fff';
            toast.style.padding = '10px 14px';
            toast.style.borderRadius = '6px';
            toast.style.zIndex = 9999;
            document.body.appendChild(toast);
        }
        toast.textContent = message;
        toast.style.opacity = '1';
        setTimeout(() => { toast.style.opacity = '0'; }, 4000);
    }

    // Start polling every 30 seconds
    setInterval(pollTeacherUpdates, 30000);
    // Run once on load
    pollTeacherUpdates();
</script>
<script>
// Live polling for teacher dashboard updates
(() => {
    const POLL_INTERVAL = 10000; // 10 seconds
    let lastData = null;

    function getCookie(name) {
        const v = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
        return v ? v.pop() : '';
    }

    function safeText(node, text) {
        if (!node) return;
        node.textContent = text;
    }

    function renderActivities(list) {
        const container = document.querySelector('#dashboard .activity-section');
        if (!container) return;
        const feed = container.querySelector('.activity-feed-list');
        // If we don't have a dedicated feed container, create one below the section title
        let feedEl = feed;
        if (!feedEl) {
            feedEl = document.createElement('div');
            feedEl.className = 'activity-feed-list';
            // insert after the section title
            const title = container.querySelector('.section-title');
            if (title && title.parentNode) title.parentNode.insertBefore(feedEl, title.nextSibling);
            else container.appendChild(feedEl);
        }

        // Clear and populate
        feedEl.innerHTML = '';
        if (!Array.isArray(list) || list.length === 0) {
            feedEl.innerHTML = '<div class="empty-text" style="padding:12px; color:var(--color5)">No recent activity</div>';
            return;
        }

        list.forEach(ev => {
            const item = document.createElement('div');
            item.className = 'activity-item';
            item.innerHTML = `<div class="activity-dot"></div><div class="activity-content"><div class="activity-title">${escapeHtml(ev.title)}</div><div class="activity-time">${formatTime(ev.time)}</div><div class="activity-detail" style="color:var(--color5); font-size:13px;">${escapeHtml(ev.detail || '')}</div></div>`;
            feedEl.appendChild(item);
        });
    }

    function escapeHtml(s){
        if (!s) return '';
        return String(s).replace(/[&<>"'`]/g, function(c){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;', '`':'&#x60;'}[c]; });
    }

    function formatTime(t){
        try {
            const d = new Date(t);
            if (isNaN(d.getTime())) return t;
            return d.toLocaleString();
        } catch(e) { return t; }
    }

    async function fetchUpdates(){
        try {
            const resp = await fetch('{% url "teacher_dashboard_updates" %}', { headers: { 'X-CSRFToken': getCookie('csrftoken') } });
            if (!resp.ok) return;
            const data = await resp.json();

            // Basic diff: update only if changed
            const changed = JSON.stringify(data) !== JSON.stringify(lastData);
            if (!changed) return;
            lastData = data;

            // Update stat cards (total courses, total students, pending tasks, attendance)
            const statNodes = document.querySelectorAll('.stats-grid .stat-card');
            // fallback mapping by index if no IDs present
            safeText(statNodes[0] && statNodes[0].querySelector('.stat-value'), data.total_courses || 0);
            safeText(statNodes[1] && statNodes[1].querySelector('.stat-value'), data.total_students || 0);
            safeText(statNodes[2] && statNodes[2].querySelector('.stat-value'), data.pending_tasks || 0);
            safeText(statNodes[3] && statNodes[3].querySelector('.stat-value'), (data.avg_attendance !== undefined ? data.avg_attendance + '%' : '0%'));

            // Update recent activity
            renderActivities(data.recent_activities || []);

        } catch (err) {
            // Silently ignore network errors; will retry on next poll
            console.warn('Dashboard update failed', err);
        }
    }

    document.addEventListener('DOMContentLoaded', function(){
        // Seed initial fetch and then poll
        fetchUpdates();
        setInterval(fetchUpdates, POLL_INTERVAL);
    });

    // One Step Quick Guide for Teachers
    function showOneStepGuideTeacher() {
        const guideHTML = `
            <div class="modal fade" id="teacherOneStepModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content" style="border-radius: 12px; border: none; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                        <div class="modal-header border-0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <h5 class="modal-title fw-bold">
                                ‚ö° One Step Quick Guide
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="step-item mb-4">
                                <div class="d-flex align-items-start gap-3">
                                    <div class="badge bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; flex-shrink: 0;">1</div>
                                    <div>
                                        <h6 class="fw-bold mb-2">Create & Manage Courses</h6>
                                        <p class="text-muted mb-0">Add new courses, set descriptions, and manage enrolled students.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="step-item mb-4">
                                <div class="d-flex align-items-start gap-3">
                                    <div class="badge bg-success rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; flex-shrink: 0;">2</div>
                                    <div>
                                        <h6 class="fw-bold mb-2">Upload Study Materials</h6>
                                        <p class="text-muted mb-0">Share lecture notes, presentations, and resources with your students.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="step-item mb-4">
                                <div class="d-flex align-items-start gap-3">
                                    <div class="badge bg-info rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; flex-shrink: 0;">3</div>
                                    <div>
                                        <h6 class="fw-bold mb-2">Create Assignments</h6>
                                        <p class="text-muted mb-0">Post assignments with due dates and monitor student submissions.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="step-item mb-4">
                                <div class="d-flex align-items-start gap-3">
                                    <div class="badge bg-warning rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; flex-shrink: 0;">4</div>
                                    <div>
                                        <h6 class="fw-bold mb-2">Schedule Classes & Events</h6>
                                        <p class="text-muted mb-0">Create and broadcast schedules for classes, exams, and events to students.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="d-flex align-items-start gap-3">
                                    <div class="badge bg-danger rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; flex-shrink: 0;">5</div>
                                    <div>
                                        <h6 class="fw-bold mb-2">Mark Attendance</h6>
                                        <p class="text-muted mb-0">Track student attendance and generate performance reports.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Got it!</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        const existingModal = document.getElementById('teacherOneStepModal');
        if (existingModal) existingModal.remove();
        
        document.body.insertAdjacentHTML('beforeend', guideHTML);
        
        const modal = new bootstrap.Modal(document.getElementById('teacherOneStepModal'));
        modal.show();
        
        document.getElementById('teacherOneStepModal').addEventListener('hidden.bs.modal', function() {
            this.remove();
        });
    }

    // Mark All Notifications as Read for Teacher
    function markAllNotificationsReadTeacher() {
        fetch('/notifications/mark-all-read/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('‚úì All notifications marked as read');
            } else {
                alert('Error marking notifications as read');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error marking notifications as read');
        });
    }
})();
</script>
{% endblock %}